var oop = require('oop').oop;

var node = require('node');



var NodeInstancier = oop.Class({
	name: 'Node Instancier',

	init: function(language, lightNode) {
		this.language = language != null ? language : null;
		this.NodeClass = lightNode ? node.nodeLight.Node : node.node.Node;

		this.hooks = [];
	},

	call: function(element, line, column, start, source) {
		var node = new this.NodeClass({
			type: {
				language: this.language,
				element: element
			},
			location: {
				start: {
					line: line,
					column: column,
					index: start
				},
				end: {
					index: start + source.length
				}
			},
			source: source
		});

		for (var i = 0, length = this.hooks.length; i < length; i++) {
			this.hooks[i](node);
		}

		return node;
	},

	methods: {
		addHook: function(fn) {
			this.hooks.push(fn);
			return fn;
		}
	}
});



exports.NodeInstancier = NodeInstancier;